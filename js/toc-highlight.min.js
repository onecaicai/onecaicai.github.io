document.addEventListener("DOMContentLoaded",function(){console.log("TOC highlight script loaded"),setTimeout(()=>{const e=document.querySelectorAll(".post-content h1, .post-content h2, .post-content h3, .post-content h4, .post-content h5, .post-content h6"),t=document.querySelectorAll('.floating-toc a[href^="#"]');if(console.log(`Found ${e.length} headings and ${t.length} TOC links`),e.length===0||t.length===0){console.log("No headings or TOC links found");return}e.forEach((e,t)=>{e.id||(e.id=`heading-${t}`)});const n=new Map;t.forEach(t=>{const s=t.getAttribute("href");if(s&&s.startsWith("#")){const i=decodeURIComponent(s.substring(1));let o=document.getElementById(i);o||e.forEach(e=>{e.textContent.trim()===i&&(o=e)}),o?(t.setAttribute("href",`#${o.id}`),n.set(o.id,t),console.log(`Mapped heading "${o.textContent.trim()}" to TOC link`)):console.log(`Could not find heading for: ${i}`)}});function o(){const o=window.pageYOffset||document.documentElement.scrollTop,i=window.innerHeight;let s=null;const a=100;for(let t=0;t<e.length;t++){const n=e[t],o=n.getBoundingClientRect();if(o.top<=a&&o.bottom>0){s=n;break}}if(!s)for(let t=0;t<e.length;t++){const n=e[t],o=n.getBoundingClientRect();if(o.top>0&&o.top<i){s=n;break}}if(!s)for(let t=e.length-1;t>=0;t--){const n=e[t],o=n.getBoundingClientRect();if(o.top<=0){s=n;break}}if(!s&&e.length>0&&(s=e[0]),t.forEach(e=>{e.classList.remove("active")}),s&&n.has(s.id)){{const t=n.get(s.id);t.classList.add("active"),console.log(`Activated TOC link for heading: "${s.textContent.trim()}" (ID: ${s.id}) at scroll position: ${o}`);const e=document.querySelector(".floating-toc");if(e){const n=t.getBoundingClientRect(),s=e.getBoundingClientRect();(n.top<s.top||n.bottom>s.bottom)&&e.scrollTo({top:e.scrollTop+(n.top-s.top)-20,behavior:"smooth"})}}}else s?console.log(`Found active heading: "${s.textContent.trim()}" but no TOC link mapped`):console.log("No active heading found")}let s=!1;function i(){s||(requestAnimationFrame(()=>{o(),s=!1}),s=!0)}window.addEventListener("scroll",i,{passive:!0}),o(),t.forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();const t=this.getAttribute("href");if(t&&t.startsWith("#")){const n=t.substring(1),e=document.getElementById(n);if(e){const t=e.offsetTop-100;window.scrollTo({top:t,behavior:"smooth"})}}})})},100)})